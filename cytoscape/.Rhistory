m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
cellwidth = 10,
cellheight =10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
title = x)
})
library(pheatmap)
?pheatmap
lapply(unique(all_data$BGC_type), function(x){
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
cellwidth = 10,
cellheight =10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x)
})
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
filter(!is.na(acc),
num_agricultures > 0,
acc != 'g1.txt') %>%
select(component, BGC_type, acc, Presence)
tree_order <- scan('~/Desktop/tree_order.txt', what = 'character')
annotation_row = data.frame(
"Agriculture" = m[rownames(nrps), ],
row.names = rownames(nrps)
)
ann_colors = list(
'Agriculture' = c(Leafcutter = 'green4', Lower = 'yellow', Coral = 'magenta3', Higher = 'blue3', 'NA' = 'white')
)
lapply(unique(all_data$BGC_type), function(x){
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
cellwidth = 10,
cellheight =10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x)
})
x <- 'NRPS'
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
nrps <- all_data %>% filter(BGC_type == x)
nrps[c(128, 129)]
nrps[c(128, 129), ]
nrps <- all_data %>% filter(BGC_type == x) %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
cellwidth = 10,
cellheight =10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x)
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
filter(!is.na(acc),
#       num_agricultures > 0,
acc != 'g1.txt') %>%
select(component, BGC_type, acc, Presence)
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
filter(!is.na(acc),
#       num_agricultures > 0,
acc != 'g1.txt') #%>%
table(all_data$Agriculture)
all_data$Agriculture
all_data$acc
unique(all_data$acc)
tree_order
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
mutate(Agriculture = ifelse(is.na(Agriculture),
yes = 'Outgroup',
no = Agriculture))
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
mutate(Agriculture = ifelse(is.na(Agriculture),
yes = 'Outgroup',
no = Agriculture)) $>$
filter(!is.na(acc),
num_agricultures > 1,
acc != 'g1.txt') #%>%
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
mutate(Agriculture = ifelse(is.na(Agriculture),
yes = 'Outgroup',
no = Agriculture)) $>$
filter(!is.na(acc),
num_agricultures > 1,
acc != 'g1.txt') #%>%
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
mutate(Agriculture = ifelse(is.na(Agriculture),
yes = 'Outgroup',
no = Agriculture)) %>%
filter(!is.na(acc),
num_agricultures > 1,
acc != 'g1.txt') #%>%
annotation_row = data.frame(
"Agriculture" = m[rownames(nrps), ],
row.names = rownames(nrps)
)
ann_colors = list(
'Agriculture' = c(Leafcutter = 'green4', Lower = 'yellow', Coral = 'magenta3', Higher = 'blue3', 'NA' = 'white')
)
x <- 'NRPS'
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
all_data <- lapply(files, function(x){
all_files[[x]] %>%
mutate(BGC_type = dirname(x))
}) %>% bind_rows() %>%
mutate(Presence = 1) %>%
mutate(Agriculture = ifelse(is.na(Agriculture),
yes = 'Outgroup',
no = Agriculture)) %>%
filter(!is.na(acc),
num_agricultures > 1,
acc != 'g1.txt') %>%
select(component, BGC_type, acc, Presence)
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
cellwidth = 10,
cellheight =10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x)
lapply(unique(all_data$BGC_type), function(x){
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
cellwidth = 10,
cellheight =10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x)
})
lapply(unique(all_data$BGC_type), function(x){
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
cellwidth = 10,
cellheight =10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x)
})
lapply(unique(all_data$BGC_type), function(x){
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 7,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x,
filename = paste0(x, 'composite.pdf'))
})
lapply(unique(all_data$BGC_type), function(x){
## per genome, presence absence across all
print(x)
nrps <- all_data %>% filter(BGC_type == x) %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x,
filename = paste0('composite_', x, '.pdf'))
})
nrps <- all_data %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps <- all_data %>%
distinct() %>%
spread(component, Presence) %>%
select(-BGC_type)
head(nrps)
?separate
nrps <- all_data %>%
distinct() %>%
unite('comp', c(component, BGC_type)) %>%
spread(comp, Presence) %>%
select(-BGC_type, -component) %>%
data.frame()
nrps <- all_data %>%
distinct() %>%
unite('comp', c(component, BGC_type)) %>%
spread(comp, Presence) %>%
data.frame()
glimpse(nrps)
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x,
filename = paste0('composite_', x, '.pdf'))
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x)
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = x,
filename = paste0('all_BGC_components_.pdf'))
pheatmap::pheatmap(nrps[rows_order,],
#        breaks = breaks,
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
filename = paste0('all_BGC_components_.pdf'))
pheatmap::pheatmap(nrps[rows_order,],
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
filename = paste0('all_BGC_components_.pdf'))
pheatmap::pheatmap(nrps[rows_order,],
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = "Components present in at least two agricultures"
filename = paste0('all_BGC_components_.pdf'))
pheatmap::pheatmap(nrps[rows_order,],
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_colors = ann_colors,
main = "Components present in at least two agricultures",
filename = paste0('all_BGC_components_.pdf'))
sub("\\_.*$", "", colnames(nrps))
nrps <- all_data %>%
distinct() %>%
unite('comp', c(BGC_type, component)) %>%
spread(comp, Presence) %>%
data.frame()
rownames(nrps) <- nrps$acc
nrps$acc <- NULL
nrps <- as.matrix(nrps)
nrps[is.na(nrps)] <- 0
rows_order <- tree_order[which(tree_order %in% rownames(nrps))]
m <- metadata %>% select(Agriculture, acc) %>% distinct() %>% data.frame()
rownames(m) <- m$acc
m$acc <- NULL
ann_colors = list(
'BGC_Type' = c(NRPS = '#1B9E77', PKS1 = '#D95F02', Terpene = '#7570B3'),
'Agriculture' = c(Leafcutter = 'green4', Lower = 'yellow', Coral = 'magenta3', Higher = 'blue3', 'NA' = 'white')
)
sub("\\_.*$", "", colnames(nrps))
RColorBrewer::brewer.pal(n = 5, name = 'Dark2')
ann_colors = list(
'BGC_Type' = c(NRPS = '#1B9E77', PKS1 = '#D95F02', Terpene = '#7570B3', Others = "#E7298A", PKS.NRP = "#66A61E"),
'Agriculture' = c(Leafcutter = 'green4', Lower = 'yellow', Coral = 'magenta3', Higher = 'blue3', 'NA' = 'white')
)
annotation_col = data.frame(
"BGC_Type" = sub("\\_.*$", "", colnames(nrps)),
row.names = colnames(nrps)
)
pheatmap::pheatmap(nrps[rows_order,],
legend = FALSE,
color = c('grey87', 'black'),
cluster_rows = FALSE,
cluster_cols = TRUE,
border_color = "grey70",
cellwidth = 10,
cellheight = 10,
annotation_row = annotation_row,
annotation_col = annotation_col,
annotation_colors = ann_colors,
main = "Components present in at least two agricultures",
filename = paste0('all_BGC_components_.pdf'))
